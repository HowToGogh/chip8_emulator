#include <string.h>

#include "init.h"
#include "../types/types.h"

uint8_t fonts[80] = {
    0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
    0x20, 0x60, 0x20, 0x20, 0x70, // 1
    0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
    0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
    0x90, 0x90, 0xF0, 0x10, 0x10, // 4
    0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
    0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
    0xF0, 0x10, 0x20, 0x40, 0x40, // 7
    0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
    0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
    0xF0, 0x90, 0xF0, 0x90, 0x90, // A
    0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
    0xF0, 0x80, 0x80, 0x80, 0xF0, // C
    0xE0, 0x90, 0x90, 0x90, 0xE0, // D
    0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
    0xF0, 0x80, 0xF0, 0x80, 0x80  // F
};

void
display_init(display_t* display) {

    for (int i = 0; i < DISPLAY_HEIGHT; ++i) {
        memset(display->monitor[i], 0, DISPLAY_WIDTH);
    }

}

void
cpu_init(cpu_t* cpu) {

    // 0x000 - 0x080 -- Fonts
    // So programs start from 0x200 
    cpu->PC = 0x200;
    cpu->I = 0;
    memset(cpu->stack, 0, sizeof(cpu->stack));
    cpu->SP = 0; // Stack empty - 0; Stack full - 16
    cpu->DT = 0;
    cpu->ST = 0;
    memset(cpu->registers, 0, sizeof(cpu->registers));
    memset(cpu->memory, 0, sizeof(cpu->memory));
    memcpy(cpu->memory, fonts, 80);

}

void
keyboard_init(keyboard_t* keyboard) {
    for (int i = 0; i < 10; ++i) {
        keyboard->keys[i].key = (char)(48 + i);
        keyboard->keys[i].pressed = false;
    }
    for (int i = 0; i < 6; ++i) {
        keyboard->keys[i + 10].key = (char)(65 + i);
        keyboard->keys[i + 10].pressed = false;
    }
}